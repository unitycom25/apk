name: Build Android APK

on: [push]

jobs:
  build:
    runs-on: ubuntu-latest
    
    steps:
    - uses: actions/checkout@v2
    
    - name: Build APK
      run: |
        # Создаем минимальные файлы если их нет
        if [ ! -f "app/build.gradle" ]; then
          echo "Creating build.gradle..."
          mkdir -p app
          echo 'plugins {
            id "com.android.application"
          }
          android {
            compileSdk 34
            defaultConfig {
              applicationId "com.protivost.game"
              minSdk 21
              targetSdk 34
              versionCode 1
              versionName "1.0"
            }
            buildTypes {
              release {
                minifyEnabled false
              }
            }
          }
          dependencies {
            implementation "androidx.appcompat:appcompat:1.6.1"
          }' > app/build.gradle
        fi
        
        # Скачиваем Gradle
        wget https://services.gradle.org/distributions/gradle-8.0-bin.zip
        unzip gradle-8.0-bin.zip
        export PATH=$PATH:$(pwd)/gradle-8.0/bin
        
        # Собираем APK
        gradle assembleDebug
        
    - name: Upload APK
      uses: actions/upload-artifact@v2
      with:
        name: protivost-app
        path: app/build/outputs/apk/debug/*.apk